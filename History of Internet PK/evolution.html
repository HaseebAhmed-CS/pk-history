<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <title>Internet Evolution in Pakistan — Timeline</title>

  <!-- Nunjucks -->
  <script src="https://cdnjs.cloudflare.com/ajax/libs/nunjucks/3.2.4/nunjucks.min.js"></script>

  <!-- Fonts -->
  <link href="https://fonts.googleapis.com/css2?family=Inter:wght@300;400;500;600;700;900&family=JetBrains+Mono:wght@400;500;700&display=swap" rel="stylesheet">

  <style>
    :root{
      --bg:#ffffff;
      --bg-soft:#f6faf8;
      --ink:#0f1720;
      --muted:#3a4e46;
      --border:#e5efe9;

      --green:#10b981;
      --green-600:#059669;
      --green-700:#047857;
      --cyan:#22eec5;

      --shadow-1:0 1px 2px rgba(16,24,32,.06), 0 8px 24px rgba(16,24,32,.06);
      --shadow-2:0 6px 18px rgba(16,24,32,.08), 0 18px 46px rgba(16,24,32,.10);

      --r-lg:24px; --r-xl:28px;
      --container:1200px;

      --step-0:clamp(.95rem,.9rem + .2vw,1rem);
      --step-1:clamp(1.1rem,1rem + .6vw,1.25rem);
      --step-2:clamp(1.35rem,1.1rem + 1.2vw,1.75rem);
      --step-3:clamp(1.8rem,1.4rem + 2vw,2.25rem);
      --step-4:clamp(2.2rem,1.8rem + 3vw,3.2rem);
    }
    *{box-sizing:border-box}
    html{scroll-behavior:smooth}
    body{
      margin:0;background:var(--bg);color:var(--ink);
      font-family:'Inter',system-ui,-apple-system,Segoe UI,Roboto,sans-serif; line-height:1.65;
      -webkit-font-smoothing:antialiased;-moz-osx-font-smoothing:grayscale;
    }
    .container{max-width:var(--container);margin:auto;padding:0 24px}

    /* Progress */
    .progress-container{position:fixed;top:0;left:0;right:0;height:4px;background:#ecfdf5;z-index:999}
    .progress-bar{height:100%;width:0;background:linear-gradient(90deg,var(--green),var(--cyan));transition:width .25s ease}

    /* Header */
    header.header{
      position:relative; overflow:hidden; isolation:isolate;
      border-bottom:1px solid var(--border); background:var(--bg-soft);
      text-align:center; padding:64px 24px;
    }
    .flag-bg{position:absolute;inset:0;z-index:-2;opacity:.12;background:url('https://upload.wikimedia.org/wikipedia/commons/3/32/Flag_of_Pakistan.svg') center/cover no-repeat}
    .flag-veil{position:absolute;inset:0;z-index:-1;background:linear-gradient(180deg,rgba(255,255,255,.9),rgba(255,255,255,.95))}
    .header-title{
      font-size:clamp(2.2rem,5vw,3.2rem);font-weight:900;letter-spacing:-.02em;margin:0;
      background:linear-gradient(135deg,var(--green),var(--cyan));
      -webkit-background-clip:text;background-clip:text;-webkit-text-fill-color:transparent;
    }
    .header-intro{max-width:860px;margin:14px auto 0}
    .intro-paragraph{color:#3c4e47;font-size:var(--step-1);margin:.6rem 0}

    /* Timeline container */
    .timeline-container{max-width:var(--container);margin:0 auto;padding:40px 24px 80px;position:relative}
    .timeline-line{
      position:absolute;top:0;bottom:0;left:50%;width:4px;transform:translateX(-50%);
      background:linear-gradient(180deg,transparent 0,var(--green) 18%,var(--cyan) 50%,var(--green) 82%,transparent 100%);
      border-radius:2px;
    }

    /* Items */
    .timeline-item{
      position:relative;display:flex;align-items:center;margin:48px 0;
      opacity:0;transform:translateY(24px);transition:opacity .55s ease, transform .55s cubic-bezier(.2,.8,.2,1);
    }
    .timeline-item.animate{opacity:1;transform:translateY(0)}
    .timeline-item:nth-child(odd){flex-direction:row}
    .timeline-item:nth-child(even){flex-direction:row-reverse}

    .timeline-content{
      flex:1;max-width:calc(50% - 40px);
      background:#fff;border:1px solid var(--border);border-radius:var(--r-xl);
      padding:22px 22px;box-shadow:var(--shadow-1);
      transition:transform .25s ease, box-shadow .25s ease, border-color .25s ease;
      cursor:default;
    }
    .timeline-content:hover{transform:translateY(-6px);box-shadow:var(--shadow-2);border-color:#cdeee2}
    .timeline-title{color:var(--green-700);font-weight:800;margin:2px 0 6px;font-size:1.25rem}
    .timeline-description{color:#3a5147}

    .timeline-year{
      position:absolute;left:50%;transform:translateX(-50%);
      background:#fff;border:1px solid var(--border);padding:8px 14px;border-radius:999px;
      font-family:'JetBrains Mono',monospace;font-weight:900;color:var(--green-700);
      box-shadow:var(--shadow-1);min-width:84px;text-align:center;
    }

    /* Arrows (subtle) */
    .timeline-item:nth-child(odd) .timeline-content::after,
    .timeline-item:nth-child(even) .timeline-content::after{
      content:"";position:absolute;top:50%;width:0;height:0;transform:translateY(-50%);
      border-top:10px solid transparent;border-bottom:10px solid transparent;
    }
    .timeline-item:nth-child(odd) .timeline-content::after{
      right:-10px;border-left:10px solid var(--border);
    }
    .timeline-item:nth-child(even) .timeline-content::after{
      left:-10px;border-right:10px solid var(--border);
    }

    /* Footer */
    footer{border-top:1px solid var(--border);background:var(--bg-soft)}
    .foot{padding:26px 0;text-align:center;color:#3c4e47}
    .foot strong{color:var(--green-700)}

    /* Loading */
    .loading{display:flex;align-items:center;justify-content:center;min-height:50vh;flex-direction:column;gap:12px}
    .spinner{width:46px;height:46px;border:3px solid rgba(16,24,32,.08);border-top:3px solid var(--green);border-radius:50%;animation:spin 1s linear infinite}
    @keyframes spin{to{transform:rotate(360deg)}}
    .loading-text{color:#4b6359}

    /* Responsive */
    @media (max-width:1024px){
      .timeline-line{left:32px;transform:none}
      .timeline-item{flex-direction:row !important;padding-left:84px}
      .timeline-content{max-width:none}
      .timeline-year{left:32px;transform:none}
      .timeline-item .timeline-content::after{left:-10px;border-right:10px solid var(--border)}
    }
    @media (max-width:640px){
      header.header{padding:48px 18px}
      .intro-paragraph{font-size:1rem}
      .timeline-item{padding-left:72px;margin:32px 0}
      .timeline-container{padding:28px 18px 64px}
      .timeline-title{font-size:1.1rem}
    }

    @media (prefers-reduced-motion:reduce){
      *{animation-duration:.01ms !important;animation-iteration-count:1 !important;transition-duration:.01ms !important}
    }
  </style>
</head>
<body>
  <!-- Progress -->
  <div class="progress-container"><div id="progress-bar" class="progress-bar"></div></div>

  <!-- Loading -->
  <div id="loading" class="loading" role="status" aria-live="polite">
    <div class="spinner" aria-hidden="true"></div>
    <div class="loading-text">Loading Pakistan’s digital timeline…</div>
  </div>

  <!-- Render target -->
  <div id="timeline-content" hidden></div>

  <!-- Template -->
  <script type="text/template" id="timeline-template">
    <header class="header">
      <div class="flag-bg" aria-hidden="true"></div>
      <div class="flag-veil" aria-hidden="true"></div>
      <h1 class="header-title">{{ title }}</h1>
      <div class="header-intro">
        {% for paragraph in introduction %}
          <p class="intro-paragraph">{{ paragraph }}</p>
        {% endfor %}
      </div>
    </header>

    <main class="timeline-container">
      <div class="timeline-line" aria-hidden="true"></div>

      {% for item in timeline %}
      <article class="timeline-item" data-year="{{ item.year }}">
        <div class="timeline-content" tabindex="0">
          <h3 class="timeline-title">{{ item.title }}</h3>
          <p class="timeline-description">{{ item.description }}</p>
        </div>
        <div class="timeline-year">{{ item.year }}</div>
      </article>
      {% endfor %}
    </main>

    <footer>
      <div class="container foot">
        <div><strong>{{ footer.credits }}</strong></div>
        <div>{{ footer.author }}</div>
        <div style="color:#5a6b64;font-size:.9rem">{{ footer.year }}</div>
      </div>
    </footer>
  </script>

  <script>
    nunjucks.configure({ autoescape: true });

    async function loadContent(){
      const loading = document.getElementById('loading');
      const target  = document.getElementById('timeline-content');
      const tpl     = document.getElementById('timeline-template').innerHTML;

      // Fallback dataset (used if fetch fails)
      const fallback = {
        title: "Internet Evolution in Pakistan (1995–2025)",
        introduction: [
          "From public internet launch to nationwide mobile broadband, explore the milestones that shaped Pakistan’s digital landscape.",
          "Scroll to see key moments across infrastructure, policy, platforms and people."
        ],
        timeline: [
          { year:"1995", title:"Public Internet Launch", description:"First commercial access; universities and ISPs enable email and early web connectivity." },
          { year:"2006", title:"DSL Era Begins", description:"Fixed-line broadband rolls out in major cities; internet cafés start to decline." },
          { year:"2014", title:"3G/4G Spectrum Auction", description:"Mobile broadband ignites mass adoption; data usage skyrockets." },
          { year:"2020", title:"Platform Regulations", description:"Content moderation and compliance debates shape the user experience." },
          { year:"2023", title:"Early 5G Trials", description:"Pilot deployments test new use cases and network capabilities." },
          { year:"2025", title:"Last‑Mile Fiber Push", description:"FTTH/FTTB expands in urban cores; new policies aim to narrow the access gap." }
        ],
        footer:{
          credits:"CM1040 Web Development — Internet in Pakistan",
          author:"Created by Aamir Mustafa · Goldsmiths, University of London",
          year:"© 2025"
        }
      };

      try{
        loading.hidden = false;
        target.hidden  = true;

        const resp = await fetch('data/evolution.json', { cache: 'no-store' });
        const data = resp.ok ? await resp.json() : fallback;

        const html = nunjucks.renderString(tpl, data || fallback);
        target.innerHTML = html;

        target.hidden = false;
        loading.remove(); // <- ensure spinner is gone

        initTimelineAnimations();
        initScrollProgress();
        initKeyboardNav();
      }catch(e){
        // Fallback render
        const html = nunjucks.renderString(tpl, fallback);
        target.innerHTML = html;

        target.hidden = false;
        loading.remove(); // <- ensure spinner is gone

        initTimelineAnimations();
        initScrollProgress();
        initKeyboardNav();
        console.warn('evolution.json failed, using fallback:', e);
      }
    }

    function initTimelineAnimations(){
      const items = document.querySelectorAll('.timeline-item');
      const io = new IntersectionObserver((entries)=>{
        entries.forEach((en, i)=>{
          if(en.isIntersecting){
            setTimeout(()=> en.target.classList.add('animate'), i * 90);
            io.unobserve(en.target);
          }
        });
      }, { threshold:.12, rootMargin:'0px 0px -80px 0px' });
      items.forEach(el=>io.observe(el));
    }

    function initScrollProgress(){
      const bar = document.getElementById('progress-bar');
      const update = ()=>{
        const max = document.body.scrollHeight - innerHeight;
        bar.style.width = Math.max(0, (pageYOffset / (max || 1)) * 100) + '%';
      };
      addEventListener('scroll', update, { passive:true });
      addEventListener('resize', update);
      update();
    }

    function initKeyboardNav(){
      document.addEventListener('keydown', (e)=>{
        const cur = document.activeElement;
        if(!cur || !cur.classList.contains('timeline-content')) return;
        if(e.key === 'ArrowDown' || e.key === 'ArrowRight'){
          e.preventDefault();
          const next = cur.closest('.timeline-item')?.nextElementSibling;
          next?.querySelector('.timeline-content')?.focus();
        }else if(e.key === 'ArrowUp' || e.key === 'ArrowLeft'){
          e.preventDefault();
          const prev = cur.closest('.timeline-item')?.previousElementSibling;
          prev?.querySelector('.timeline-content')?.focus();
        }
      });
    }

    document.addEventListener('DOMContentLoaded', loadContent);

    // Smooth internal links
    document.addEventListener('click', (e)=>{
      const a = e.target.closest("a[href^='#']");
      if(!a) return;
      e.preventDefault();
      document.querySelector(a.getAttribute('href'))?.scrollIntoView({ behavior:'smooth', block:'start' });
    });
  </script>
</body>
</html>
